{
  "hash": "0fcd835405edd5e2b723b644b5196a62",
  "result": {
    "markdown": "---\ntitle: \"Azimuthal projections\"\noutput:\n  html_document:\n    code_folding: show\nauthor: Liam D. Bailey\ndate: '2024-08-31'\ndescription: \"Best way to plot a hemisphere\"\ncategories: [R, Data viz, GIS]\nimage: \"feature.png\"\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## Introduction: You're just projecting\n\n---\n\nOne of the first things you learn when reading (or making) a map is the complexity of *projection*. Any map is a 2D representation of a 3D object (i.e. the ellipsoid of the Earth). This means that we inevitably end up losing information in our endeavour to map the world.\n\nDiscussions of map projections often focus on different projections designed for *world* maps, those which can represent the whole planet (for better or worse) in a single space. However, in some cases we have no interest in representing the whole world and may instead want to create a map focussed on a particular region or location. Azimuthal projections are a useful projection type for these use cases.\n\n</br>\n\n## The theory: What the heck is an azimuth?\n\n---\n\nAn azimuth (from the Arabic السموت) is an angle measured relative to some cardinal direction (e.g. N). For example, the azimuth of true south relative to true north is 180°. An azimuthal projection takes a flat plane that is a tangent to the Earth's surface with a single tangent point where the plane and Earth intersect. Points from the Earth are then projected onto this plane (see below).\n\n![Example of an azimuthal projection ([Bellerby & Co. Globemakers](https://blog.bellerbyandco.com/uncategorized/get-to-know-a-projection-azimuthal-orthographic/))](./data/tangent_example.png)\n\nAll azimuthal projections are based around this central tangent point and all azimuths (i.e. directions) from this central point are preserved accurately in the projection. Different azimuthal projections experience different types of distortion, but in all cases the level of distortion is lowest at the central point and increases equally as you move further away from the central point *in any direction*.\n\nBy focussing on a central point, azimuthal projections can do a great job of representing a particular *section* of the Earth (e.g. one hemisphere). Once you move far enough away from the central point the map can become harder to read. In many Azimuthal projections, areas too far from the central point are not even visible.\n\n</br>\n\n## The practice: How do I use an azimuthal projection?\n\n---\n\nFor this task, we need polygons from the `s2` package that work with spherical geometry. A discussion of spherical geometry is too much for this post. All we need to know is that these polygons can work in azimuthal projections with any central point (i.e. even polar regions).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountries <- s2_data_countries() ## Read in a polygon of all countries\n```\n:::\n\n\nNow that we have our polygons, we can project them into an azimuthal projection around a central point. To show the power of azimuthal projections, we'll focus our maps in the Southern Hemisphere around Melbourne (lat: -37.8136, lon: 144.9631). This is a perspective of the globe (including Antarctica) that is less often represented.\n\nAs a first example of an azimuthal projection, let's use Azimuthal Equal-Area. As the name suggests, this projection will be azimuthal (i.e. around a central point) and will accurately represent the *area* of shapes on the map.\n\n::: {.callout-note}\nIn ggplot2, it is possible to transform objects on the fly by specifying a CRS inside `coord_sf()`; however, I've found this process to be fragile. Projecting objects *before* plotting has been much more successful for me.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Create a proj string to describe the projection\n## The projection alias is 'laea'\n## The variables lat_0 and lon_0 represent our central point\ncrs <- \"+proj=laea +lat_0=-37.8136 +lon_0=144.9631\"\n\n## Project our objects to this new projection\n## Convert them into sf objects for easily plotting in ggplot\ncountries_laea <- st_transform(st_as_sfc(countries),\n                               crs)\n\n## Create a plot\nggplot() +\n  geom_sf(data = countries_laea,\n          fill = \"grey50\", colour = \"grey10\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThe areas of our countries might be preserved, but the shape certainly is not. While we can *technically* include a country like Canada or the US, it is so far from Australia that the shape is completely distorted. Here we can see why azimuthal projections are less well suited for world maps. To make our plot neater, let's clip our data to just show one hemisphere. I'll also add in some neat graticules (i.e. lines of lat/lon) and ocean polygon to make the plot easier to read (in folded code).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Clip around our central point\nbuffer <- s2_buffer_cells(\n  ## Specify our central point\n  as_s2_geography(\"POINT(144.9631 -37.8136)\"),\n  ## 9800km is the radius of the buffer to show one whole hemisphere of the earth\n  distance = 9800000,\n  ## How smooth is the buffer? Higher will be smoother (default: 1000)\n  max_cells = 5000\n)\n## Clip our country polygons using this buffer\ncountries_clip <- s2_intersection(buffer, countries)\n## Reproject to laea\ncountries_clip_laea <- st_transform(st_as_sfc(countries_clip),\n                                    crs)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n### OCEAN\n## To create ocean polygon, determine the *inverse* of all countries\n## Clip and transform ocean\nglobe <- s2::as_s2_geography(TRUE) ## The whole Earth\nocean <- s2_difference(globe, s2_union_agg(countries))\nocean_clip <- s2_intersection(buffer, ocean)\nocean_clip_laea <- st_transform(st_as_sfc(ocean_clip),\n                                crs)\n\n### GRATICULES\n## Specify range of lines of longitudinal\n## (i.e. lines running N-S)\nmeridian_long <- seq(-180, 175, 10)\n## Create linestring for each line\nlong_lines <- lapply(X = meridian_long,\n                     FUN = \\(x){\n                       sf::st_linestring(x = data.frame(V1 = x,\n                                                        V2 = seq(-90, 90, 1)) |>\n                                           as.matrix())}) |> \n  sf::st_sfc(crs = \"EPSG:4326\")\n\n## Do the same process for lines of latitude (i.e. E-W)\nmeridian_lat <- seq(-80, 80, 10)\nlat_lines <- lapply(X = meridian_lat,\n                    FUN = \\(x){\n                      sf::st_linestring(x = data.frame(V1 = seq(-180, 180, 1),\n                                                       V2 = x) |>\n                                          as.matrix())}) |> \n  sf::st_sfc(crs = \"EPSG:4326\")\n\n#Combine together into a single dataset\ngraticules <- c(lat_lines, long_lines)\n#Clip and reproject these graticules\ngraticules_clip <- s2_intersection(buffer, graticules)\ngraticules_clip_laea <- st_transform(st_as_sfc(graticules_clip),\n                                crs)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = ocean_clip_laea,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_laea,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_laea,\n          fill = \"grey50\", colour = \"grey10\") +\n  labs(title = \"AZIMUTHAL EQUAL-AREA\") +\n  theme_void() +\n  theme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n</br>\n\n## The possibilites: What other azimuthal projections should I try?\n\n---\n\n### Azimuthal Equidistant Projection\n\nUnlike the equal area projection, Azimuthal Equidistant will maintain accurate distances across the map. This type of projection has a common use in flight path mapping as all flight paths can be easily compared.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n## Create a proj string to describe the projection\n## The projection alias is 'ortho'\n## The variables lat_0 and lon_0 represent our central point\ncrs_aeqd <- \"+proj=aeqd +lat_0=-37.8136 +lon_0=144.9631\"\n\ncountries_clip_aeqd <- st_transform(st_as_sfc(countries_clip),\n                                crs_aeqd)\nocean_clip_aeqd <- st_transform(st_as_sfc(ocean_clip),\n                                crs_aeqd)\ngraticules_clip_aeqd <- st_transform(st_as_sfc(graticules_clip),\n                                crs_aeqd)\n\nggplot() +\n  geom_sf(data = ocean_clip_aeqd,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_aeqd,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_aeqd,\n          fill = \"grey50\", colour = \"grey10\") +\n  labs(title = \"AZIMUTHAL EQUIDISTANT\") +\n  theme_void() +\n  theme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Orthographic projection\n\nOne powerful azimuthal projection is Orthographic projection. Unlike many projections that seek to preserve some feature like area or shape, the orthographic projection maps one hemisphere with accurate *perspective*. In other words, it represents the Earth as it would look from space.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n## Create a proj string to describe the projection\n## The projection alias is 'ortho'\n## The variables lat_0 and lon_0 represent our central point\ncrs_ortho <- \"+proj=ortho +lat_0=-37.8136 +lon_0=144.9631\"\n\ncountries_clip_ortho <- st_transform(st_as_sfc(countries_clip),\n                                crs_ortho)\nocean_clip_ortho <- st_transform(st_as_sfc(ocean_clip),\n                                crs_ortho)\ngraticules_clip_ortho <- st_transform(st_as_sfc(graticules_clip),\n                                crs_ortho)\n\nggplot() +\n  geom_sf(data = ocean_clip_ortho,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_ortho,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_ortho,\n          fill = \"grey50\", colour = \"grey10\") +\n  labs(title = \"ORTHOGRAPHIC\") +\n  theme_void() +\n  theme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#|echo: false\n\nfeatureplot <- ggplot() +\n  geom_sf(data = ocean_clip_ortho,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_ortho,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_ortho,\n          fill = \"grey50\", colour = \"grey10\") +\n  theme_void()\n\nggplot2::ggsave(plot = featureplot, filename = \"./feature.png\", dpi = 600, width = 7, height = 7)\n```\n:::\n\n\n### Near-side general perspective (or Vertical perspective)\n\nThe orthographic projection represent a view of Earth from an infinitely large distance above the surface. With the near-side general perspective projection, we can create a view of the Earth from a specific height above the surface. This is particularly handy to represent how the Earth is viewed by different satellites.\n\nBelow, we create two different maps that simulate the view from the International Space Station (~400km altitude) and the European Galileo satellite (~23,000km altitude).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n## Create a function that will create plot for any given height\nnsper_plot <- function(h, lat_0, lon_0, countries, ocean, graticules){\n\n## Create a proj string to describe the projection\n## The projection alias is 'nsper'\n## The variables lat_0 and lon_0 represent our central point\nx <- s2::s2_earth_radius_meters() ## Radius of the Earth\nq <- sqrt(x^2 - ((x^2)/(x + h))^2) ## Radius of the segment of the Earth viewed from height h\n\n## Proj string for nsper at height h and lat/lon centre point\ncrs_nsper <- paste0(\"+proj=nsper +h=\", h, \" +lat_0=\", lat_0, \" +lon_0=\", lon_0)\n\n## We need to create a new buffer\nbuffer2 <- s2_buffer_cells(\n  ## Specify our central point\n  as_s2_geography(paste0(\"POINT(\", lon_0, \" \", lat_0, \")\")),\n  distance = q,\n  max_cells = 5000 ## Specify how smooth the buffer will be (default 1000)\n)\n\ncountries_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, countries)),\n                                crs_nsper)\nocean_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, ocean)),\n                                crs_nsper)\ngraticules_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, graticules)),\n                                crs_nsper)\n\nggplot() +\n  geom_sf(data = ocean_clip_nsper_meo,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_nsper_meo,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_nsper_meo,\n          fill = \"grey50\", colour = \"grey10\") +\n  theme_void()\n\n}\n\nISS_plot <- nsper_plot(h = 400000, lat_0 = -37.8136, lon_0 = 144.9631, countries, ocean, graticules) +\nlabs(title = \"NEAR-SIDE GENERAL PERSPECTIVE\",\n  subtitle = \"International Space Station\\n(Near-Earth orbit)\") +\ntheme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14),\nplot.subtitle = element_text(family = \"Chivo\", hjust = 0.5, size = 7))\n\nGalileo_plot <- nsper_plot(h = 2.3e+07, lat_0 = -37.8136, lon_0 = 144.9631, countries, ocean, graticules) +\nlabs(title = \"NEAR-SIDE GENERAL PERSPECTIVE\",\n  subtitle = \"Galileo Satellite\\n(Mid-Earth orbit)\") +\ntheme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14),\nplot.subtitle = element_text(family = \"Chivo\", hjust = 0.5, size = 7))\n\nISS_plot + Galileo_plot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### General perspective (or Tilted perspective)\n\nWe can expand on this projection still further and consider the angle (or tilt) of the view. The near-side general perspective assumes a view looking directly towards the centre of the Earth, but many views, such as those from the ISS, might be tilted.\n\nLet's imagine a similar view of Melbourne from the ISS but tilted at 10 degrees.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n## Create a function that will create plot for any given height\ntpers_plot <- function(h, tilt, lat_0, lon_0, countries, ocean, graticules){\n\n## Create a proj string to describe the projection\n## The projection alias is 'nsper'\n## The variables lat_0 and lon_0 represent our central point\nx <- s2::s2_earth_radius_meters() ## Radius of the Earth\nq <- sqrt(x^2 - ((x^2)/(x + h))^2) ## Radius of the segment of the Earth viewed from height h\n\n## Proj string for nsper at height h and lat/lon centre point\ncrs_tpers <- paste0(\"+proj=tpers +h=\", h, \" +tilt=\", tilt, \" +lat_0=\", lat_0, \" +lon_0=\", lon_0)\n\n## We need to create a new buffer\nbuffer2 <- s2_buffer_cells(\n  ## Specify our central point\n  as_s2_geography(paste0(\"POINT(\", lon_0, \" \", lat_0, \")\")),\n  distance = q,\n  max_cells = 5000 ## Specify how smooth the buffer will be (default 1000)\n)\n\ncountries_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, countries)),\n                                crs_tpers)\nocean_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, ocean)),\n                                crs_tpers)\ngraticules_clip_nsper_meo <- st_transform(st_as_sfc(s2_intersection(buffer2, graticules)),\n                                crs_tpers)\n\nggplot() +\n  geom_sf(data = ocean_clip_nsper_meo,\n          fill = \"lightblue\", colour = NA) +\n  ## Place graticules *over* the ocean\n  geom_sf(data = graticules_clip_nsper_meo,\n          colour = \"grey10\", linewidth = 0.1) +\n  geom_sf(data = countries_clip_nsper_meo,\n          fill = \"grey50\", colour = \"grey10\") +\n  theme_void()\n\n}\n\nISS_plot_tilt10 <- tpers_plot(h = 400000, tilt = 10, lat_0 = -37.8136, lon_0 = 144.9631, countries, ocean, graticules) +\nlabs(title = \"GENERAL (TILTED) PERSPECTIVE\",\n  subtitle = \"International Space Station\\n(Near-Earth orbit)\\n10 degree tilt\") +\ntheme(plot.title = element_text(family = \"Chivo\", hjust = 0.5, size = 14),\nplot.subtitle = element_text(family = \"Chivo\", hjust = 0.5, size = 7))\n\nISS_plot + ISS_plot_tilt10\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}